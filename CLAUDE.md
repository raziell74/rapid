# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Is

R.A.P.I.D. is a Skyrim SE/AE SKSE plugin that hooks into `BSResource::LooseFileLocation` directory traversal to replace the engine's slow `FindFirstFile`/`FindNextFile` enumeration with a pre-built binary cache generated by a companion MO2 Python plugin. The result is near-instant loose file registration at boot, bypassing both the OS file enumeration APIs and MO2's USVFS proxy overhead entirely.

## Build

Requires MSVC, CMake 3.21+, and vcpkg with `VCPKG_ROOT` set. Dependencies are sourced from a custom registry (`Monitor221hz/modding-vcpkg-ports`) for `commonlibsse-ng-fork`.

```bash
# Configure
cmake --preset build-debug-msvc

# Build
cmake --build --preset debug-msvc
```

Output goes to `build/release-msvc/` or `build/debug-msvc/`. If `SKYRIM_MODS_FOLDER` is set, the compiled `.dll` is automatically copied to `$SKYRIM_MODS_FOLDER/RAPID - Resource Asset Path Indexing and Dispatch/SKSE/Plugins/`.

## Architecture

The plugin is early-stage. The two core files that will house the actual implementation are currently stubs:

- `src/hook.h` / `src/hook.cpp` — where the `BSResource::LooseFileLocation` trampoline hook lives (currently empty)
- `src/settings.h` — INI-based configuration (currently empty)

The scaffolding that is in place:

- `src/plugin.cpp` — SKSE plugin entry point; calls `SKSE::Init`, sets up logging, and registers the message listener
- `src/log.h` — `SetupLog()` wires spdlog to `%SKSE_LOG_DIR%/<PluginName>.log` at trace level
- `src/PCH.h` — precompiled header; pulls in `RE/Skyrim.h` and `SKSE/SKSE.h`
- `src/util.h` — utility namespaces: `PointerUtil`, `SystemUtil::File`, `KeyUtil`, `Util::String`, `MathUtil`, `ObjectUtil`, `FormUtil`, `NifUtil`, `AnimUtil`

## Key Conventions

- C++23 (`cxx_std_23`), MSVC only, x64, dynamic CRT linkage
- `RE::` prefix for Reversed Engine types (CommonLibSSE-NG), `SKSE::` for SKSE interfaces
- Address Library offsets via `RELOCATION_ID(se_id, ae_id)` for cross-version compatibility
- New source files must be added to `cmake/sourcelist.cmake`; new headers to `cmake/headerlist.cmake`
- The custom vcpkg triplet (`x64-windows-skse`) statically links everything except `skse` and `fully-dynamic-game-engine` packages
